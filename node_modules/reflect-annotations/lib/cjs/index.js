"use strict";
Object.defineProperty(exports, "__esModule", { value: true });
exports.AnnotationFactory = exports.isAnnotationFactory = exports.createAnnotationFactory = exports.setParameterAnnotations = exports.getParameterAnnotations = exports.setAnnotations = exports.getAnnotations = exports.reflectAnnotations = void 0;
const annotations_js_1 = require("./annotations.js");
Object.defineProperty(exports, "getAnnotations", { enumerable: true, get: function () { return annotations_js_1.getAnnotations; } });
Object.defineProperty(exports, "setAnnotations", { enumerable: true, get: function () { return annotations_js_1.setAnnotations; } });
Object.defineProperty(exports, "getParameterAnnotations", { enumerable: true, get: function () { return annotations_js_1.getParameterAnnotations; } });
Object.defineProperty(exports, "setParameterAnnotations", { enumerable: true, get: function () { return annotations_js_1.setParameterAnnotations; } });
Object.defineProperty(exports, "createAnnotationFactory", { enumerable: true, get: function () { return annotations_js_1.createAnnotationFactory; } });
Object.defineProperty(exports, "isAnnotationFactory", { enumerable: true, get: function () { return annotations_js_1.isAnnotationFactory; } });
Object.defineProperty(exports, "AnnotationFactory", { enumerable: true, get: function () { return annotations_js_1.AnnotationFactory; } });
const reflect_class_js_1 = require("./reflect-class.js");
class PropertyDescription {
    constructor(name, declaredOrder) {
        this.name = name;
        this.declaredOrder = declaredOrder;
        this.classAnnotations = [];
        this.methodAnnotations = [];
        this.parameterAnnotations = [];
        this.types = {};
    }
}
function addClassAnnotation(property, annotation) {
    property.classAnnotations.push(annotation);
    return property;
}
function addMethodAnnotation(property, annotation) {
    property.methodAnnotations.push(annotation);
    return property;
}
function collectPropertyAnnotations(property, ctor) {
    const methodAnnotations = property.name in ctor.prototype ? annotations_js_1.getAnnotations(ctor.prototype, property.name) : [], order = property.declaredOrder ? 'reduceRight' : 'reduce';
    property = annotations_js_1.getAnnotations(ctor)[order](addClassAnnotation, methodAnnotations[order](addMethodAnnotation, property));
    property.parameterAnnotations =
        property.name in ctor.prototype ? annotations_js_1.getParameterAnnotations(ctor.prototype, property.name) : [];
    property.types.parameters = annotations_js_1.getParameterTypes(ctor.prototype, property.name);
    property.types.return = annotations_js_1.getReturnType(ctor.prototype, property.name);
    return property;
}
function reflectAnnotations(source, options = { declaredOrder: true }) {
    const classMetadata = reflect_class_js_1.reflectClassProperties(source);
    return classMetadata.properties.reduce((properties, propertyName) => {
        properties.push(classMetadata.constructors.reduceRight(collectPropertyAnnotations, new PropertyDescription(propertyName, options.declaredOrder)));
        return properties;
    }, []);
}
exports.reflectAnnotations = reflectAnnotations;
exports.default = reflectAnnotations;
//# sourceMappingURL=data:application/json;base64,eyJ2ZXJzaW9uIjozLCJmaWxlIjoiaW5kZXguanMiLCJzb3VyY2VSb290IjoiIiwic291cmNlcyI6WyIuLi8uLi9zcmMvaW5kZXgudHMiXSwibmFtZXMiOltdLCJtYXBwaW5ncyI6Ijs7O0FBQUEscURBWXlCO0FBdUV2QiwrRkFsRkEsK0JBQWMsT0FrRkE7QUFDZCwrRkFsRkEsK0JBQWMsT0FrRkE7QUFDZCx3R0FsRkEsd0NBQXVCLE9Ba0ZBO0FBQ3ZCLHdHQWxGQSx3Q0FBdUIsT0FrRkE7QUFDdkIsd0dBaEZBLHdDQUF1QixPQWdGQTtBQUN2QixvR0EvRUEsb0NBQW1CLE9BK0VBO0FBQ25CLGtHQTlFQSxrQ0FBaUIsT0E4RUE7QUE1RW5CLHlEQUEyRDtBQVczRCxNQUFNLG1CQUFtQjtJQUt2QixZQUFtQixJQUFZLEVBQVMsYUFBc0I7UUFBM0MsU0FBSSxHQUFKLElBQUksQ0FBUTtRQUFTLGtCQUFhLEdBQWIsYUFBYSxDQUFTO1FBSjlELHFCQUFnQixHQUFlLEVBQUUsQ0FBQTtRQUNqQyxzQkFBaUIsR0FBZSxFQUFFLENBQUE7UUFDbEMseUJBQW9CLEdBQWUsRUFBRSxDQUFBO1FBQ3JDLFVBQUssR0FBRyxFQUFFLENBQUE7SUFDdUQsQ0FBQztDQUNuRTtBQUVELFNBQVMsa0JBQWtCLENBQUMsUUFBc0MsRUFBRSxVQUFlO0lBQ2pGLFFBQVEsQ0FBQyxnQkFBZ0IsQ0FBQyxJQUFJLENBQUMsVUFBVSxDQUFDLENBQUE7SUFDMUMsT0FBTyxRQUFRLENBQUE7QUFDakIsQ0FBQztBQUNELFNBQVMsbUJBQW1CLENBQUMsUUFBc0MsRUFBRSxVQUFlO0lBQ2xGLFFBQVEsQ0FBQyxpQkFBaUIsQ0FBQyxJQUFJLENBQUMsVUFBVSxDQUFDLENBQUE7SUFDM0MsT0FBTyxRQUFRLENBQUE7QUFDakIsQ0FBQztBQUVELFNBQVMsMEJBQTBCLENBQ2pDLFFBQXNDLEVBQ3RDLElBQW9CO0lBRXBCLE1BQU0saUJBQWlCLEdBQ25CLFFBQVEsQ0FBQyxJQUFJLElBQUksSUFBSSxDQUFDLFNBQVMsQ0FBQyxDQUFDLENBQUMsK0JBQWMsQ0FBQyxJQUFJLENBQUMsU0FBUyxFQUFFLFFBQVEsQ0FBQyxJQUFJLENBQUMsQ0FBQyxDQUFDLENBQUMsRUFBRSxFQUN0RixLQUFLLEdBQUcsUUFBUSxDQUFDLGFBQWEsQ0FBQyxDQUFDLENBQUMsYUFBYSxDQUFDLENBQUMsQ0FBQyxRQUFRLENBQUE7SUFDM0QsUUFBUSxHQUFHLCtCQUFjLENBQUMsSUFBSSxDQUFDLENBQUMsS0FBSyxDQUFDLENBQ3BDLGtCQUFrQixFQUNsQixpQkFBaUIsQ0FBQyxLQUFLLENBQUMsQ0FBK0IsbUJBQW1CLEVBQUUsUUFBUSxDQUFDLENBQ3RGLENBQUE7SUFDRCxRQUFRLENBQUMsb0JBQW9CO1FBQzNCLFFBQVEsQ0FBQyxJQUFJLElBQUksSUFBSSxDQUFDLFNBQVMsQ0FBQyxDQUFDLENBQUMsd0NBQXVCLENBQUMsSUFBSSxDQUFDLFNBQVMsRUFBRSxRQUFRLENBQUMsSUFBSSxDQUFDLENBQUMsQ0FBQyxDQUFDLEVBQUUsQ0FBQTtJQUMvRixRQUFRLENBQUMsS0FBSyxDQUFDLFVBQVUsR0FBRyxrQ0FBaUIsQ0FBQyxJQUFJLENBQUMsU0FBUyxFQUFFLFFBQVEsQ0FBQyxJQUFJLENBQUMsQ0FBQTtJQUM1RSxRQUFRLENBQUMsS0FBSyxDQUFDLE1BQU0sR0FBRyw4QkFBYSxDQUFDLElBQUksQ0FBQyxTQUFTLEVBQUUsUUFBUSxDQUFDLElBQUksQ0FBQyxDQUFBO0lBQ3BFLE9BQU8sUUFBUSxDQUFBO0FBQ2pCLENBQUM7QUFFRCxTQUFTLGtCQUFrQixDQUN6QixNQUFzQixFQUN0QixVQUFzQyxFQUFFLGFBQWEsRUFBRSxJQUFJLEVBQUU7SUFFN0QsTUFBTSxhQUFhLEdBQUcseUNBQXNCLENBQUMsTUFBTSxDQUFDLENBQUE7SUFFcEQsT0FBTyxhQUFhLENBQUMsVUFBVSxDQUFDLE1BQU0sQ0FDcEMsQ0FBQyxVQUFVLEVBQUUsWUFBWSxFQUFFLEVBQUU7UUFDM0IsVUFBVSxDQUFDLElBQUksQ0FDYixhQUFhLENBQUMsWUFBWSxDQUFDLFdBQVcsQ0FDcEMsMEJBQTBCLEVBQzFCLElBQUksbUJBQW1CLENBQUMsWUFBWSxFQUFFLE9BQU8sQ0FBQyxhQUFhLENBQUMsQ0FDN0QsQ0FDRixDQUFBO1FBQ0QsT0FBTyxVQUFVLENBQUE7SUFDbkIsQ0FBQyxFQUNELEVBQUUsQ0FDSCxDQUFBO0FBQ0gsQ0FBQztBQUlRLGdEQUFrQjtBQUYzQixrQkFBZSxrQkFBa0IsQ0FBQSJ9